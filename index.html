<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KUOå¤©æ°£å¹³å°</title>
    <link rel="icon" type="image/png" href="./icon.png">

    <!-- å­—é«”ï¼šæ¸…æ¥šã€å¯è®€æ€§å¼· -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&family=Noto+Sans+TC:wght@500;700;900&display=swap" rel="stylesheet">

    <style>
        /* ----------------------------------------------------
           ã€ŠTurbo Granny éˆç•° UI - ç°¡ç´„ç‰ˆã€‹
           ---------------------------------------------------- */

        :root {
            --pink: #ff70d3;
            --green: #99ffd8;
            --purple: #6d4aff;
            --dark: #0f0b16;
            --card: rgba(255, 255, 255, 0.08);
            --text: #f4ecff;
        }

        body {
            font-family: "Noto Sans TC", "Zen Maru Gothic", sans-serif;
            background: #120c1d;
            color: var(--text);
            margin: 0;
            padding-bottom: 20px;

            /* æŸ”å’Œç´«å…‰ï¼Œä¸åˆºçœ¼ */
            background-image:
                radial-gradient(circle at 30% 20%, rgba(140, 70, 255, 0.18), transparent 60%),
                radial-gradient(circle at 80% 80%, rgba(255, 80, 200, 0.18), transparent 70%);
        }

        /* è¼•å¾®é›œè¨Šï¼ˆæ›´æ·¡ï¼‰ */
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: url("https://i.imgur.com/A9kqQ0h.png");
            opacity: 0.02;
            pointer-events: none;
        }

        /* ----------------------------------------------------
           é ‚éƒ¨ç‹€æ…‹åˆ—
        ---------------------------------------------------- */
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .location-pill {
            background: var(--purple);
            padding: 6px 18px;
            border-radius: 20px;
            font-weight: 900;
            color: white;
            font-size: 1.1rem;
        }

        .update-pill {
            font-size: .9rem;
            opacity: 0.8;
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: auto;
        }

        /* ----------------------------------------------------
           ä¸»å¡ç‰‡ï¼ˆç°¡æ½”ï¼‰
        ---------------------------------------------------- */
        .hero-card {
            background: var(--card);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 25px;
            border-radius: 18px;
            backdrop-filter: blur(14px);
            margin-bottom: 25px;
        }

        .hero-period {
            background: var(--green);
            color: #000;
            padding: 5px 16px;
            border-radius: 14px;
            display: inline-block;
            font-weight: 900;
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        .hero-icon {
            font-size: 4rem;
        }

        .hero-temp {
            font-size: 4rem;
            font-weight: 900;
            margin-top: 8px;
        }

        .hero-desc {
            font-size: 1.35rem;
            font-weight: 700;
            color: #e8ddff;
            margin-bottom: 20px;
        }

        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .advice-item {
            background: rgba(255,255,255,0.07);
            border-radius: 14px;
            padding: 12px;
            text-align: center;
        }

        .advice-icon {
            font-size: 2rem;
            margin-bottom: 6px;
        }

        .advice-text {
            font-size: 1.2rem;
            font-weight: 800;
        }

        /* ----------------------------------------------------
           ç¨å¾Œé å ±ï¼ˆä¹¾æ·¨è¨­è¨ˆï¼‰
        ---------------------------------------------------- */
        .section-title {
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--green);
            margin-left: 5px;
            margin-bottom: 12px;
        }

        .scroll-container {
            display: flex;
            gap: 14px;
            overflow-x: auto;
        }
        .scroll-container::-webkit-scrollbar { display:none; }

        .mini-card {
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.12);
            padding: 15px;
            border-radius: 14px;
            min-width: 120px;
            text-align: center;
        }

        .mini-time {
            background: var(--purple);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: .9rem;
            margin-bottom: 8px;
        }

        .mini-icon {
            font-size: 2rem;
            margin-bottom: 6px;
        }

        .mini-temp {
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* æœ€æ·¡ ghost orb */
        .ghost-orb {
            position: fixed;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, rgba(255,150,230,0.5), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.4;
        }

        /* Loading */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: #150f21;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            z-index: 999;
        }
    </style>
</head>

<body>

    <!-- å¹½éˆå…‰é»ï¼ˆæ·¡ï¼‰ -->
    <div class="ghost-orb" style="top:20%; left:25%;"></div>
    <div class="ghost-orb" style="top:70%; left:60%;"></div>

    <div id="loading" class="loading-screen">
        <div style="font-size: 3rem;">ğŸ‘»</div>
        <p style="margin-top: 12px;">æ­£åœ¨å–å¾—å¤©æ°£â€¦</p>
    </div>

    <div class="status-bar">
        <div class="location-pill">ğŸ“ æ–°ç«¹</div>
        <div id="updateTime" class="update-pill">æ›´æ–°ä¸­â€¦</div>
    </div>

    <div class="container" id="mainContent" style="display:none;">
        <div id="heroCard"></div>
        <h3 class="section-title">ç¨å¾Œé å ±</h3>
        <div class="scroll-container" id="futureForecasts"></div>
    </div>

    <script>
    const API_URL = "https://weather-hsz-kuo.zeabur.app/api/weather/hsinchu";

    // æŠŠ "28Â°C" -> 28 é€™ç¨®
    function toNumberTemp(tempStr) {
        if (tempStr == null) return NaN;
        const m = String(tempStr).match(/-?\d+(\.\d+)?/); // æŠ“è£¡é¢çš„æ•¸å­—
        return m ? parseFloat(m[0]) : NaN;
    }

    function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        return "ğŸŒ¤ï¸";
    }

    function getAdvice(rainProb, maxTempStr) {
        let rainIcon = "ğŸŒ‚", rainText = "ä¸ç”¨å¸¶å‚˜";
        if (parseInt(rainProb) > 30) {
            rainIcon = "â˜‚ï¸"; 
            rainText = "è¨˜å¾—å¸¶å‚˜";
        }

        const maxTemp = toNumberTemp(maxTempStr); // "28Â°C" -> 28

        let clothIcon = "ğŸ‘•", clothText = "èˆ’æœçš„å¤©æ°£ğŸ˜€";
        if (maxTemp >= 28) { 
            clothIcon = "ğŸ½"; 
            clothText = "å¤ªç†±äº†ğŸ¥µ"; 
        } else if (maxTemp <= 23) { 
            clothIcon = "ğŸ§¥"; 
            clothText = "æœ‰é»æ¶¼ğŸ˜¶â€ğŸŒ«ï¸"; 
        } else if (maxTemp <= 18) { 
            clothIcon = "ğŸ§¥"; 
            clothText = "çœŸçš„å†·ğŸ¥¶"; 
        }

        return { rainIcon, rainText, clothIcon, clothText };
    }

    function safeDate(str) {
        // CWA çµ¦çš„æ˜¯ "2025-02-24 06:00:00"ï¼Œè½‰æˆè¼ƒå®‰å…¨çš„æ ¼å¼
        return new Date(String(str).replace(" ", "T"));
    }

    function getTimePeriod(startTime) {
        const h = safeDate(startTime).getHours();
        if (h < 5) return "æ·±å¤œ";
        if (h < 11) return "æ—©æ™¨";
        if (h < 14) return "ä¸­åˆ";
        if (h < 18) return "ä¸‹åˆ";
        if (h < 23) return "æ™šä¸Š";
        return "æ·±å¤œ";
    }

    function renderWeather(data) {
        const fs = data.forecasts;
        const cur = fs[0];
        const list = fs.slice(1);

        const period = getTimePeriod(cur.startTime);

        const maxT = toNumberTemp(cur.maxTemp);
        const minT = toNumberTemp(cur.minTemp);
        const avgTemp = Math.round((maxT + minT) / 2);  // é€™è£¡å°±ä¸æœƒ NaN äº†

        const advice = getAdvice(cur.rain, cur.maxTemp);

        document.getElementById("heroCard").innerHTML = `
            <div class="hero-card">
                <div class="hero-period">${period}</div>

                <div class="hero-icon">${getWeatherIcon(cur.weather)}</div>
                <div class="hero-temp">${avgTemp}Â°</div>
                <div class="hero-desc">${cur.weather}</div>

                <div class="advice-grid">
                    <div class="advice-item">
                        <div class="advice-icon">${advice.rainIcon}</div>
                        <div class="advice-text">${advice.rainText}</div>
                        <div style="font-size:.75rem; opacity:.7;">é™é›¨ç‡ ${cur.rain}</div>
                    </div>
                    <div class="advice-item">
                        <div class="advice-icon">${advice.clothIcon}</div>
                        <div class="advice-text">${advice.clothText}</div>
                        <div style="font-size:.75rem; opacity:.7;">æœ€é«˜æº« ${cur.maxTemp}</div>
                    </div>
                </div>
            </div>
        `;

        /* å°å¡ç‰‡ */
        const today = new Date().getDate();
        const box = document.getElementById("futureForecasts");
        box.innerHTML = "";

        list.forEach(f => {
            let p = getTimePeriod(f.startTime);
            const d = safeDate(f.startTime).getDate();
            if (d !== today) p = "æ˜å¤©" + p;

            box.innerHTML += `
                <div class="mini-card">
                    <div class="mini-time">${p}</div>
                    <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                    <div class="mini-temp">${f.minTemp} - ${f.maxTemp}</div>
                    <div style="font-size:.8rem; opacity:.6;">ğŸ’§${f.rain}</div>
                </div>
            `;
        });

        const now = new Date();
        document.getElementById("updateTime").textContent =
            `${now.getMonth() + 1}/${now.getDate()}`;
    }

    async function fetchWeather() {
        try {
            const delay = new Promise(r => setTimeout(r, 900));
            const fetchData = fetch(API_URL).then(r => r.json());
            const [_, json] = await Promise.all([delay, fetchData]);

            if (json.success && json.data && json.data.forecasts) {
                renderWeather(json.data);
                document.getElementById("loading").style.display = "none";
                document.getElementById("mainContent").style.display = "block";
            } else {
                alert("è³‡æ–™æ ¼å¼ç•°å¸¸ï¼");
                console.log("API å›å‚³å…§å®¹ï¼š", json);
            }
        } catch (e) {
            console.error(e);
            alert("è³‡æ–™å–å¾—å¤±æ•—ï¼");
        }
    }

    document.addEventListener("DOMContentLoaded", fetchWeather);
</script>

</body>
</html>